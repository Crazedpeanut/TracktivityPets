{% extends 'tracktivityPetsWebsite/base.html' %}
{% load staticfiles %}

{% block navbar %}
    {% include 'tracktivityPetsWebsite/navigationbar.html' %}
{% endblock navbar %}

{% block content_block %}


    <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
	        
	<script type="text/javascript">
        $(document).ready(function()
        {                        
            $("#inventory_grid_button").click(function()
            {
                if (screen.width <= 768) {
                    $('#myModal').modal();
                }                
            });
        });
    </script>
    
	<script type="text/javascript">
		$(document).ready(function() {
			
			var activeTab = "pets";
			
			$("#collected > div").click(function(event) 
			{
				var id = $(this).attr("id").split("_").pop(); //unpurchased_x becomes x
				
				if(activeTab === "pets")
				{
				  	$.ajax( "{% url 'tracktivityPetsWebsite:view_purchased_pet' %}" + id)
					.done(function(data) {	
					  	var obj = JSON.parse(data);
					    $("#inventory_detail_header").html(obj.name);
					    $("#inventory_detail_one").html("Level " + obj.level);
					    $("#inventory_detail_description").html(obj.story);
					    $("#inventory_detail_image").attr("src", obj.image);
					    $("#inventory_detail_two").html(obj.age + " Days Old");
					    $("div[id*='selected_']").attr("id", "selected_" + id);
					});
				}
				else if(activeTab === "cosmetics")
				{
						
				}
			});
			
			$( ".activate_button" ).click(function() {
				var id = $("div[id*='selected_']").attr("id").split("_").pop(); //unpurchased_x becomes x
				$.ajax( "{% url 'tracktivityPetsWebsite:set_current_pet' %}" + id)
				.done(function(data) {
				  	if(data === "False")
				  		alert("Failed");
				  	else
				  		alert("Successfully Activated");
				});
			});
			
			$("#inventory_tabs li").click(function(event) {
				var newActiveTab = $(this).attr('id');
				
				if(newActiveTab !== activeTab)
				{
					if(newActiveTab === "pets")
					{
						$.ajax( "{% url 'tracktivityPetsWebsite:inventory' %}" + "pets")
						.done(function(data) {
						  /*	var obj = JSON.parse(data);
						    $("#inventory_detail_header").html(obj.name);
						    $("#inventory_detail_pet_level").html("Level " + obj.level);
						    $("#inventory_detail_pet_description").html(obj.story);
						    $("#inventory_detail_image").attr("src", obj.image);
						    $("#inventory_detail_pet_age").html(obj.age + " Days Old");
						    $("div[id*='selected_']").attr("id", "selected_" + id);	
						    <button class="btn btn-lg btn-primary col-md-3 col-centred" type="button">Rename</button>
			        		<button class="btn btn-lg btn-primary col-md-3 col-centred activate_button" type="button">Activate!</button>
						    */
						});
					}
					else if(newActiveTab === "scenery")
					{
						$.ajax( "{% url 'tracktivityPetsWebsite:inventory' %}" + "scenery")
						.done(function(data) {	
						    alert(data);
						});
					}
					else if(newActiveTab === "cosmetics")
					{
						$.ajax( "{% url 'tracktivityPetsWebsite:inventory' %}" + "cosmetics")
						.done(function(data) {	
						    var obj = JSON.parse(data);
						    
						    var insert_div = $("#collected");
						    insert_div.html("");
						    
						    for(var item in obj.collected) {
						    	html = "<div class='col-xs-4' class='inventory_pet' id='collected_" + obj.collected[item].pk + "'>";
						    	html += "<button class=''>";
						    	html += "<img class='img-responsive img-circle' src='" + obj.collected[item].image + "'>";
						    	html += "<p class=''>" + item + "</p> </button></div>";
						    	insert_div.append(html);
						    }
						    
						    
						    try {

						    	$("#inventory_detail_header").html(obj.details.name);
						    	$("#inventory_detail_image").attr("src", obj.details.image);
						    	$("#inventory_detail_description").html(obj.details.description);
						    	$("#inventory_detail_one").html("Equipped on:  " + obj.details.equipped_on);
						    	$("#inventory_detail_two").html("");
						    	var buttons = '<button class="btn btn-lg btn-primary col-md-3 col-centred" type="button">Unequip</button><button class="btn btn-lg btn-primary col-md-3 col-centred equip_button" type="button">Equip</button>';
						    	$("#inventory_detail_buttons").html(buttons);
						    	
						    }
						    catch(err) {
						    	//no items exist yet
						    }
						});
					}
				}
				
				activeTab = newActiveTab;
			});
		});
	</script>
	
{{ image }}
    <div class="container" id="inventory_header">
        <div class="row">
            <img class="bubbletext_header col-xs-12 col-md-4 col-md-offset-4" src="{% static 'tracktivityPetsWebsite/images/inventory_text.png' %}">
        </div>
    </div>

    <div class="container" id="inventory_container">
        <ul class="nav nav-tabs" id="inventory_tabs">
            <li class="active col-md-2 col-xs-4" id="pets"><a href="#">Pets</a></li>
            <li class="col-md-2 col-xs-4" id="scenery"><a href="#">Scenery</a></li>
            <li class="col-md-2 col-xs-4"  id="cosmetics"><a href="#">Cosmetics</a></li>            
        </ul>    
        
        <div class="col-md-6 container" id="inventory_grid">  

        	<span id="collected">
	            {% for key, value in collected_pets.items %}
		            <div class="col-xs-4" class="inventory_pet" id="collected_{{ value.pk }}">
		            	<button class="">
		                <img class="img-responsive img-circle" src="{{ value.image }}">
		                <p class="">{{ key }}</p>
		                </button>            
		            </div>
	            {% endfor %}
            </span>
                         
           
        </div>            	
			<div class="col-xs-6 container hidden-xs" id="inventory_detail">
				<div hidden id="selected_{{ default.pk }}" > </div>
			    <div class="row"><h2 class="col-centred" id="inventory_detail_header">{{ default.name }}</h2></div>
			    <div class="row"><img class="img-responsive col-xs-9 col-centred" src="{{ default.image }}" id="inventory_detail_image"></div>
			    <div class="row">
			        <p id="inventory_detail_description" class="col-xs-12 col-md-8 col-centred">
			            {{ default.story }}
			        </p>
			    </div>        
			    <div class="row"><h4 id="inventory_detail_one">Level {{ default.level }}</h4></div>
			    <div class="row"><h5 id="inventory_detail_two">{{ default.age }} Days Old</h5></div>
			    <div class="row" id="inventory_detail_buttons">
			        <button class="btn btn-lg btn-primary col-md-3 col-centred" type="button">Rename</button>
			        <button class="btn btn-lg btn-primary col-md-3 col-centred activate_button" type="button">Activate!</button>
			    </div>
			</div>
			
			<div class="container">            
			    <!-- Modal -->
			    <div class="modal fade" id="myModal" role="dialog" id="inventory_detail_modal">
			        <div class="modal-dialog">
			      
			        <!-- Modal content-->
			        <div class="modal-content">
			            <div class="modal-header">
			                <button type="button" class="close" data-dismiss="modal">&times;</button>
			                <h4 class="modal-title">{{ default.name }}</h4>
			            </div>
			            <div class="modal-body">
			                <img class="img-responsive col-xs-9 col-centred" src="{{ default.image }}" />
			                <p>{{ default.story }}</p>
			                <div><h4 id="inventory_detail_pet_level">Level {{ default.level }}</h3></div>
			                <div><h5 id="inventory_detail_pet_age">{{ default.age }} Days Old</h5></div>
			            </div>
			            
			            <div class="modal-footer">
			                <button type="button" class="btn btn-default" data-dismiss="modal">Dismiss</button>
			                <button type="button" class="btn btn-default" data-dismiss="modal">Rename</button>
			                <button type="button" class="btn btn-default" data-dismiss="modal">Activate!</button>
			            </div>
			        </div>        
			    </div>
			 </div>
        </div>  
    </div>
   

{% endblock content_block %}