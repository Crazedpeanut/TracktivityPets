<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tracktivityPetsWebsite.utils &mdash; Tracktivity Pets 1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Tracktivity Pets 1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for tracktivityPetsWebsite.utils</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">fitapp</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">tracktivityPetsWebsite.models</span> <span class="kn">import</span> <span class="n">Inventory</span><span class="p">,</span> <span class="n">Profile</span><span class="p">,</span> <span class="n">CollectedPet</span><span class="p">,</span> <span class="n">Level</span><span class="p">,</span> <span class="n">Pet</span><span class="p">,</span> <span class="n">Scenery</span><span class="p">,</span> <span class="n">CollectedScenery</span>
<span class="kn">from</span> <span class="nn">tracktivityPetsWebsite.models</span> <span class="kn">import</span> <span class="n">Experience</span><span class="p">,</span> <span class="n">Happiness</span><span class="p">,</span> <span class="n">Story</span><span class="p">,</span> <span class="n">Item</span><span class="p">,</span> <span class="n">CollectedItem</span><span class="p">,</span> <span class="n">PetSwap</span>
<span class="kn">from</span> <span class="nn">tracktivityPetsWebsite.models</span> <span class="kn">import</span> <span class="n">UserMicroChallenge</span><span class="p">,</span> <span class="n">UserMicroChallengeState</span><span class="p">,</span> <span class="n">MicroChallengeGoal</span><span class="p">,</span>\
    <span class="n">MicroChallengeState</span><span class="p">,</span> <span class="n">STEPS_IN_DURATION</span><span class="p">,</span> <span class="n">UserMicroChallengeGoalStatus</span><span class="p">,</span> <span class="n">UserNotification</span><span class="p">,</span>\
    <span class="n">LEVEL_UP</span><span class="p">,</span> <span class="n">EXPERIENCE_GAINED</span><span class="p">,</span> <span class="n">STORY_UNLOCKED</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">django</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">import</span> <span class="nn">fitapp</span>
<span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">get_current_site</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ObjectDoesNotExist</span>
<span class="kn">from</span> <span class="nn">django.templatetags.static</span> <span class="kn">import</span> <span class="n">static</span>
<span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="n">HOST_NAME</span><span class="p">,</span> <span class="n">LOG_LOCATION</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">hdlr</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">LOG_LOCATION</span> <span class="o">+</span> <span class="s">&#39;/tracktivitypets_utils.log&#39;</span><span class="p">)</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%(asctime)s</span><span class="s"> </span><span class="si">%(levelname)s</span><span class="s"> </span><span class="si">%(message)s</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">hdlr</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">hdlr</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>


<span class="c">#TODO: need to compensate for all the possible codes recieved from fitbit-django (such as 101, etc)</span>

<div class="viewcode-block" id="retrieve_fitapp_data"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.retrieve_fitapp_data">[docs]</a><span class="k">def</span> <span class="nf">retrieve_fitapp_data</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">date_from</span><span class="p">,</span> <span class="n">date_to</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">     When everything goes well, the *status_code* is 100 and the requested data</span>
<span class="sd">    is included. However, there are a number of things that can &#39;go wrong&#39;</span>
<span class="sd">    with this call. For each type of error, we return an empty data list with</span>
<span class="sd">    a *status_code* to describe what went wrong on our end:</span>

<span class="sd">        :100: OK - Response contains JSON data.</span>
<span class="sd">        :101: User is not logged in.</span>
<span class="sd">        :102: User is not integrated with Fitbit.</span>
<span class="sd">        :103: Fitbit authentication credentials are invalid and have been</span>
<span class="sd">            removed.</span>
<span class="sd">        :104: Invalid input parameters. Either *period* or *end_date*, but not</span>
<span class="sd">            both, must be supplied. *period* should be one of [1d, 7d, 30d,</span>
<span class="sd">            1w, 1m, 3m, 6m, 1y, max], and dates should be of the format</span>
<span class="sd">            &#39;yyyy-mm-dd&#39;.</span>
<span class="sd">        :105: User exceeded the Fitbit limit of 150 calls/hour.</span>
<span class="sd">        :106: Fitbit error - please try again soon.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_fitbit_linked</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;No fitbit found&#39;</span>
    <span class="k">elif</span> <span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;No current pet&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">HOST_NAME</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">get_username</span><span class="p">()</span>
        <span class="c">#compute secure hash so people cant intercept this crappy call (since request object doesnt work)</span>
        <span class="nb">hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">pbkdf2_hmac</span><span class="p">(</span><span class="s">&#39;sha256&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">settings</span><span class="o">.</span><span class="n">SECRET_KEY</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="mi">100000</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">({</span><span class="s">&#39;hash&#39;</span><span class="p">:</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="nb">hash</span><span class="p">),</span>
                                         <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                                         <span class="s">&#39;base_date&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_from</span><span class="p">),</span>
                                         <span class="s">&#39;end_date&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">date_to</span><span class="p">)})</span>
        <span class="c">#make a request to this page</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&quot;http://&quot;</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s">&quot;/fitbit/get_data/activities/steps/?&quot;</span> <span class="o">+</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span><span class="c">#whats returned</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="c">#TODO: make this something useful</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="c">#change it from text to something usable</span>


<span class="c">#TODO: Gets all steps for the day, and doesnt consider other pets already having steps for it</span>
<span class="c">#Not going to effect release 1, but needs to change for release 2. Will have to loop through each pet in users inventory, get the experience for the day, add it all up, minus that from the total steps, and then add that to the pet</span></div>
<div class="viewcode-block" id="update_user_fitbit"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.update_user_fitbit">[docs]</a><span class="k">def</span> <span class="nf">update_user_fitbit</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Gets the steps from last_fitbit_sync to today, handles and stores the data in happiness/experience models </span>
<span class="sd">    #TODO: change this to be ajax suitable, so a button press can asynchronously call this method, and then get notified that update is done</span>
<span class="sd">    this method will probably take 2-3 seconds to run, since fitbit API can take a while to respond, so ajax would be good</span>
<span class="sd">    means it should go in the update_user_fitbit</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">profile</span>

    <span class="c">#pull steps from last_fitbit_sync upto today</span>
    <span class="k">if</span> <span class="n">profile</span><span class="o">.</span><span class="n">last_fitbit_sync</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">d_from</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">date_joined</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d_from</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">last_fitbit_sync</span>

    <span class="n">date_from</span> <span class="o">=</span> <span class="n">d_from</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span> <span class="c">#todays date in format yyyy-mm-dd</span>

    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">date_to</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span> <span class="c">#todays date in format yyyy-mm-dd</span>

    <span class="n">result</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">retrieve_fitapp_data</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">date_from</span><span class="p">,</span> <span class="n">date_to</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">result</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;data dump: &quot;</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">data_json</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">if</span> <span class="n">data_json</span><span class="p">[</span><span class="s">&#39;meta&#39;</span><span class="p">][</span><span class="s">&#39;status_code&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span><span class="c">#temp stuff for testing</span>
        <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="n">data_json</span><span class="p">[</span><span class="s">&#39;meta&#39;</span><span class="p">][</span><span class="s">&#39;status_code&#39;</span><span class="p">]</span><span class="c">#TODO: make this something useful</span>

    <span class="n">experience</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">data_json</span><span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">]:</span> <span class="c">#terrible code reuse</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        datetime_object = datetime.datetime.strptime(date[&#39;dateTime&#39;], &#39;%Y-%m-%d&#39;)</span>
<span class="sd">        swap_counts = count_pet_swaps_for_day(datetime_object)</span>
<span class="sd">        swap_counts += 1</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="c">#Handle null vals</span>
            <span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span>

        <span class="k">if</span> <span class="n">date</span><span class="p">[</span><span class="s">&#39;dateTime&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">date_from</span><span class="p">:</span> <span class="c">#this day may already have data, if its synced multiple times a day, should do this a less exhaustive way though</span>
            <span class="k">try</span><span class="p">:</span><span class="c">#update it</span>
                <span class="n">existing_experience</span> <span class="o">=</span> <span class="n">Experience</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pet</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;dateTime&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot; 00:00:00+00:00&quot;</span><span class="p">)</span>
                <span class="n">existing_happiness</span> <span class="o">=</span> <span class="n">Happiness</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pet</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;dateTime&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot; 00:00:00+00:00&quot;</span><span class="p">)</span>

                <span class="n">happiness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="c">#100 is used to set &#39;100%&#39;</span>
                <span class="n">happiness</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">happiness</span><span class="p">)</span><span class="c">#Division of happiness and experience for pets active throughout day</span>
                <span class="n">existing_happiness</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">happiness</span>
                <span class="n">existing_experience</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span><span class="c">#Division of happiness and experience for pets active throughout day</span>
                <span class="n">experience</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">existing_experience</span><span class="o">.</span><span class="n">amount</span><span class="p">)</span> <span class="c">#new - old = amount gained</span>
                <span class="n">existing_experience</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="n">existing_happiness</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                
            <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span> <span class="c">#only create a new one for it if the day doesnt exist, which should presumably only be the first ever time</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="n">Experience</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pet</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]),</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;dateTime&#39;</span><span class="p">])</span>
                <span class="n">experience</span> <span class="o">+=</span> <span class="n">exp</span><span class="o">.</span><span class="n">amount</span>
                <span class="n">happiness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="c">#100 is used to set &#39;100%&#39;</span>
                <span class="n">happiness</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">happiness</span><span class="p">)</span><span class="c">#Division of happiness and experience for pets active throughout day</span>
                <span class="n">Happiness</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pet</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">happiness</span><span class="p">),</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;dateTime&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exp</span> <span class="o">=</span> <span class="n">Experience</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pet</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]),</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;dateTime&#39;</span><span class="p">])</span>
            <span class="n">experience</span> <span class="o">+=</span> <span class="n">exp</span><span class="o">.</span><span class="n">amount</span>
            <span class="n">happiness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="c">#100 is used to set &#39;100%&#39;</span>
            <span class="n">happiness</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">happiness</span><span class="p">)</span><span class="c">#Division of happiness and experience for pets active throughout day</span>
            <span class="n">Happiness</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pet</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">happiness</span><span class="p">),</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;dateTime&#39;</span><span class="p">])</span>
            
    <span class="n">current_level</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">level</span>
    <span class="n">update_pet_level</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="p">)</span>
    <span class="n">new_level</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">level</span>           

    <span class="n">data_to_return</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data_to_return</span><span class="p">[</span><span class="s">&#39;experience_gained&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">experience</span>
    <span class="n">data_to_return</span><span class="p">[</span><span class="s">&#39;levels_gained&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_level</span> <span class="o">-</span> <span class="n">current_level</span>
    <span class="c">#data_to_return[&#39;pet_pennies_gained&#39;] = 0</span>
    <span class="n">data_to_return</span><span class="p">[</span><span class="s">&#39;stories&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c">#see if any new stories are unlocked and create UserStory here</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">current_level</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">while</span> <span class="n">level</span> <span class="o">&lt;=</span> <span class="n">new_level</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">Level</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
            <span class="n">story</span> <span class="o">=</span> <span class="n">Story</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">level_unlocked</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">pet</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="o">.</span><span class="n">pet</span><span class="p">)</span><span class="c">#get any stories for that level</span>
            <span class="n">data_to_return</span><span class="p">[</span><span class="s">&#39;stories&#39;</span><span class="p">][</span><span class="n">l</span><span class="o">.</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="n">story</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c">#no story for this level</span>
        <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="c">#happiness += int(date[&#39;value&#39;]) / data_json[&#39;meta&#39;][&#39;total_count&#39;] / 100 #need to cap this at 100 #if ever want average of the retrieved stuff</span>
    
    <span class="c">#change last_fitbit_sync to todays date</span>
    <span class="n">profile</span><span class="o">.</span><span class="n">last_fitbit_sync</span> <span class="o">=</span> <span class="n">date_to</span>
    <span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">if</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data_to_return</span><span class="p">[</span><span class="s">&#39;experience_gained&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">experienceNotification</span> <span class="o">=</span> <span class="n">UserNotification</span><span class="p">()</span>
        <span class="n">experienceNotification</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">data_to_return</span><span class="p">[</span><span class="s">&#39;experience_gained&#39;</span><span class="p">]</span>
        <span class="n">experienceNotification</span><span class="o">.</span><span class="n">notificationType</span> <span class="o">=</span> <span class="n">EXPERIENCE_GAINED</span>
        <span class="n">experienceNotification</span><span class="o">.</span><span class="n">userProfile</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">experienceNotification</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">if</span><span class="p">(</span><span class="n">data_to_return</span><span class="p">[</span><span class="s">&#39;levels_gained&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">levelNotification</span> <span class="o">=</span> <span class="n">UserNotification</span><span class="p">()</span>
        <span class="n">levelNotification</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">data_to_return</span><span class="p">[</span><span class="s">&#39;levels_gained&#39;</span><span class="p">]</span>
        <span class="n">levelNotification</span><span class="o">.</span><span class="n">notificationType</span> <span class="o">=</span> <span class="n">LEVEL_UP</span>
        <span class="n">levelNotification</span><span class="o">.</span><span class="n">userProfile</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">levelNotification</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">story</span> <span class="ow">in</span> <span class="n">data_to_return</span><span class="p">[</span><span class="s">&#39;stories&#39;</span><span class="p">]:</span>
        <span class="n">storyNotification</span> <span class="o">=</span> <span class="n">UserNotification</span><span class="p">()</span>
        <span class="n">storyNotification</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Unlocked a new Story!&quot;</span>
        <span class="n">storyNotification</span><span class="o">.</span><span class="n">notificationType</span> <span class="o">=</span> <span class="n">STORY_UNLOCKED</span>
        <span class="n">storyNotification</span><span class="o">.</span><span class="n">userProfile</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">storyNotification</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">data_to_return</span>
    <span class="c">#if request.method == GET</span>
        <span class="c">#return ajax friendly data</span>
    <span class="c">#else</span>
        <span class="c">#render dashboard page</span>
</div>
<div class="viewcode-block" id="count_pet_swaps_for_day"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.count_pet_swaps_for_day">[docs]</a><span class="k">def</span> <span class="nf">count_pet_swaps_for_day</span><span class="p">(</span><span class="n">day</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the amount of times a user has swapped pets during a single day.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">swaps</span> <span class="o">=</span> <span class="n">PetSwap</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">time_swapped__year</span><span class="o">=</span><span class="n">day</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">time_swapped__day</span><span class="o">=</span><span class="n">day</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">time_swapped__month</span><span class="o">=</span><span class="n">day</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">swaps</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="register_user"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.register_user">[docs]</a><span class="k">def</span> <span class="nf">register_user</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">confirm_password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">registerForm</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; A new user is created based up values passed in, returns None if there is no problems, otherwise a string with the error &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">registerForm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">registerForm</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span> <span class="c">#Using registerForm to enter details</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">registerForm</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">registerForm</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]</span>
            <span class="n">confirmPass</span> <span class="o">=</span> <span class="n">registerForm</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;confirmPass&#39;</span><span class="p">]</span>
            <span class="n">firstName</span> <span class="o">=</span> <span class="n">registerForm</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;firstname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">surname</span> <span class="o">=</span> <span class="n">registerForm</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;surname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">registerForm</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">password</span> <span class="o">!=</span> <span class="n">confirmPass</span> <span class="ow">or</span> <span class="n">password</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">email</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">email</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;Not all values have been set&#39;</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">email</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">password</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">first_name</span><span class="o">=</span><span class="n">firstName</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">last_name</span> <span class="o">=</span> <span class="n">surname</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">inventory</span> <span class="o">=</span> <span class="n">Inventory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
                <span class="n">inventory</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">inventory</span><span class="o">=</span><span class="n">inventory</span><span class="p">)</span>
                <span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            
        

<span class="c">#TODO: Untested</span></div>
<div class="viewcode-block" id="register_pet_selection"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.register_pet_selection">[docs]</a><span class="k">def</span> <span class="nf">register_pet_selection</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">pet</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Used for when a user picks their first pet. Creates a new current pet and assigns it to the user (and default scenery)&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">None</span> <span class="c">#user already has a current pet</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="n">Level</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c">#dodgy code, but can presume level 1 will always exist</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span> <span class="c">#should change this to form of user.profile, but it doesnt seem to work </span>
            
            <span class="n">scenery</span> <span class="o">=</span> <span class="n">Scenery</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Oak Tree Park&quot;</span><span class="p">)</span>
            <span class="n">collected_scenery</span> <span class="o">=</span> <span class="n">CollectedScenery</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">scenery</span><span class="o">=</span><span class="n">scenery</span><span class="p">,</span> <span class="n">inventory</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span>
            <span class="n">collected_scenery</span><span class="o">.</span><span class="n">save</span><span class="p">()</span><span class="c">#these 3 lines of code are untested</span>
            
            <span class="n">collected_pet</span> <span class="o">=</span> <span class="n">CollectedPet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pet</span><span class="o">=</span><span class="n">pet</span><span class="p">,</span> <span class="n">inventory</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">date_created</span><span class="o">=</span><span class="n">now</span><span class="p">,</span> <span class="n">scenery</span><span class="o">=</span><span class="n">collected_scenery</span><span class="p">)</span> <span class="c">#create new collected pet</span>
            <span class="n">collected_pet</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span> <span class="o">=</span> <span class="n">collected_pet</span> <span class="c">#link it to user.profile.current_pet </span>
            <span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c">#forces a refresh on the pet to see if it&#39;s level should be different</span></div>
<div class="viewcode-block" id="update_pet_level"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.update_pet_level">[docs]</a><span class="k">def</span> <span class="nf">update_pet_level</span><span class="p">(</span><span class="n">collected_pet</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks if a pets level should be updated, if so, perform the update.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">experience</span> <span class="o">=</span> <span class="n">collected_pet</span><span class="o">.</span><span class="n">get_total_experience</span><span class="p">()</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">Level</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">experience_needed__lte</span><span class="o">=</span><span class="n">experience</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-experience_needed&#39;</span><span class="p">)</span>
        <span class="n">collected_pet</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">collected_pet</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
            </div>
<div class="viewcode-block" id="update_pet_level_with_value"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.update_pet_level_with_value">[docs]</a><span class="k">def</span> <span class="nf">update_pet_level_with_value</span><span class="p">(</span><span class="n">collected_pet</span><span class="p">,</span> <span class="n">experience</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Updates a pet level with an amount of experience.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">Level</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">experience_needed__lte</span><span class="o">=</span><span class="n">experience</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-experience_needed&#39;</span><span class="p">)</span>
        <span class="n">collected_pet</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">collected_pet</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="get_pet_selection_data"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.get_pet_selection_data">[docs]</a><span class="k">def</span> <span class="nf">get_pet_selection_data</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return all of the pet information required for the initial pet selection view.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">pets</span> <span class="o">=</span> <span class="n">Pet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">levelOne</span> <span class="o">=</span> <span class="n">Level</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">start_url</span> <span class="o">=</span> <span class="n">static</span><span class="p">(</span><span class="s">&#39;tracktivityPetsWebsite/images&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">pet</span> <span class="ow">in</span> <span class="n">pets</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">pet</span><span class="o">.</span><span class="n">default_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">data</span><span class="p">[</span><span class="n">pet</span><span class="o">.</span><span class="n">default_name</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pet</span><span class="o">.</span><span class="n">default_name</span>
            <span class="n">data</span><span class="p">[</span><span class="n">pet</span><span class="o">.</span><span class="n">default_name</span><span class="p">][</span><span class="s">&#39;story&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pet</span><span class="o">.</span><span class="n">story_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">level_unlocked</span><span class="o">=</span><span class="n">levelOne</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="c">#get the level one story for each pet</span>
            <span class="n">image_location</span> <span class="o">=</span> <span class="n">pet</span><span class="o">.</span><span class="n">mood_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">happiness_needed</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">image_location</span>
            <span class="n">data</span><span class="p">[</span><span class="n">pet</span><span class="o">.</span><span class="n">default_name</span><span class="p">][</span><span class="s">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{url}/pets/{name}/{location}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">start_url</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pet</span><span class="o">.</span><span class="n">default_name</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">image_location</span><span class="p">)</span>
            <span class="n">silohuette_image_location</span> <span class="o">=</span> <span class="n">pet</span><span class="o">.</span><span class="n">mood_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">happiness_needed</span><span class="o">=-</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">image_location</span>
            <span class="n">data</span><span class="p">[</span><span class="n">pet</span><span class="o">.</span><span class="n">default_name</span><span class="p">][</span><span class="s">&#39;silohuette&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{url}/pets/{name}/{location}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">start_url</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pet</span><span class="o">.</span><span class="n">default_name</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">silohuette_image_location</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c">#do nothing, but pet isnt set up properly in admin view (needs a story at level 1, and image at -1 happiness)</span>
    <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="get_current_pet"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.get_current_pet">[docs]</a><span class="k">def</span> <span class="nf">get_current_pet</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the logged in users current pet.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span>
</div>
<div class="viewcode-block" id="set_current_pet"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.set_current_pet">[docs]</a><span class="k">def</span> <span class="nf">set_current_pet</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">owned_pet</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Swaps the logged in users pet with the one specified. The one specified must be owned by the user.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">num_pets</span> <span class="o">=</span> <span class="n">CollectedPet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">inventory</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">num_pets</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">pet_swap</span> <span class="o">=</span> <span class="n">PetSwap</span><span class="p">(</span><span class="n">from_pet</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span><span class="p">,</span> <span class="n">to_pet</span><span class="o">=</span><span class="n">owned_pet</span><span class="p">)</span>
            <span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">current_pet</span> <span class="o">=</span> <span class="n">owned_pet</span>
            <span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    </div>
<div class="viewcode-block" id="set_current_scenery"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.set_current_scenery">[docs]</a><span class="k">def</span> <span class="nf">set_current_scenery</span><span class="p">(</span><span class="n">collected_pet</span><span class="p">,</span> <span class="n">collected_scenery</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Swaps the logged in users scenery with the one specified. The scenery specified must be ownned by the user.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">collected_pet</span><span class="o">.</span><span class="n">scenery</span> <span class="o">=</span> <span class="n">collected_scenery</span>
        <span class="n">collected_pet</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
  
</div>
<div class="viewcode-block" id="is_item_on_bodypart"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.is_item_on_bodypart">[docs]</a><span class="k">def</span> <span class="nf">is_item_on_bodypart</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">collected_pet</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns true if an item is already on that body part or false if no objects on the body part</span>
<span class="sd">    were found.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">collected_items</span> <span class="o">=</span> <span class="n">collected_pet</span><span class="o">.</span><span class="n">inventory</span><span class="o">.</span><span class="n">get_collected_items_for_pet</span><span class="p">(</span><span class="n">collected_pet</span><span class="o">.</span><span class="n">pet</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">collected_items</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">body_part</span> <span class="o">==</span> <span class="n">part</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">equipped</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>   
    <span class="k">return</span> <span class="bp">False</span> <span class="c">#no objects on the body part were found</span>
</div>
<div class="viewcode-block" id="equip_item"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.equip_item">[docs]</a><span class="k">def</span> <span class="nf">equip_item</span><span class="p">(</span><span class="n">collected_pet</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">part</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Equips an item onto a pets body part. The item must be owned by the user.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">collected_items</span> <span class="o">=</span> <span class="n">collected_pet</span><span class="o">.</span><span class="n">inventory</span><span class="o">.</span><span class="n">get_collected_items_for_pet</span><span class="p">(</span><span class="n">collected_pet</span><span class="o">.</span><span class="n">pet</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">collected_items</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">body_part</span> <span class="o">==</span> <span class="n">part</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">equipped</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">equipped</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">item</span><span class="o">.</span><span class="n">equipped</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="get_user"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.get_user">[docs]</a><span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>

</div>
<div class="viewcode-block" id="is_fitbit_linked"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.is_fitbit_linked">[docs]</a><span class="k">def</span> <span class="nf">is_fitbit_linked</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Returns whether a user has a linked fitbit account or not &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">fitapp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">is_integrated</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="generate_pet_image_url"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.generate_pet_image_url">[docs]</a><span class="k">def</span> <span class="nf">generate_pet_image_url</span><span class="p">(</span><span class="n">pet</span><span class="p">,</span> <span class="n">image_location</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Helper function to generate the path of a pets image.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">start_url</span> <span class="o">=</span> <span class="n">static</span><span class="p">(</span><span class="s">&#39;tracktivityPetsWebsite/images&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;{url}/pets/{name}/{location}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">start_url</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pet</span><span class="o">.</span><span class="n">default_name</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">image_location</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="update_user_challenges"><a class="viewcode-back" href="../../modules/utils.html#tracktivityPetsWebsite.utils.update_user_challenges">[docs]</a><span class="k">def</span> <span class="nf">update_user_challenges</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The update user challenges method goes through all of a users currently active challenges</span>
<span class="sd">    and checks if they have been achieved. If so, a UserNotification is generated to th user can be notified.</span>

<span class="sd">    If user has completed a challenge they are rewarded with the pet pennies specified by the MicroChallengeGoal.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">uc_queryset</span> <span class="o">=</span> <span class="n">UserMicroChallenge</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Checking challenged for user: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">get_username</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">uc</span> <span class="ow">in</span> <span class="n">uc_queryset</span><span class="p">:</span>
        <span class="n">micro_chal</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">micro_challenge</span>
        <span class="n">micro_chal_goals</span> <span class="o">=</span> <span class="n">MicroChallengeGoal</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">micro_challenge</span><span class="o">=</span><span class="n">micro_chal</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Checking challenge: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">micro_chal</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">micro_chal</span><span class="o">.</span><span class="n">challenge_type</span> <span class="o">==</span> <span class="n">STEPS_IN_DURATION</span><span class="p">:</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">steps_during_json</span> <span class="o">=</span> <span class="n">retrieve_fitapp_data</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">date_started</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">),</span> <span class="n">uc</span><span class="o">.</span><span class="n">date_end</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">))</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Checking dates from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">uc</span><span class="o">.</span><span class="n">date_started</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">uc</span><span class="o">.</span><span class="n">date_end</span><span class="p">)))</span>

            <span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># Reset steps back to zero</span>

            <span class="c">#Update steps for UserMicroChallenge</span>
            <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">steps_during_json</span><span class="p">[</span><span class="s">&#39;objects&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="c">#Handle null vals</span>
                    <span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span>
                <span class="n">steps</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Updating state steps from: </span><span class="si">%d</span><span class="s"> to </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uc</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span><span class="p">,</span> <span class="n">uc</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">+</span> <span class="n">steps</span><span class="p">))</span>
                <span class="n">uc</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">+=</span> <span class="n">steps</span>
            <span class="n">uc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c"># Save new step count for challenge</span>

            <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="n">micro_chal_goals</span><span class="p">:</span>

                <span class="n">user_micro_chal_goal_status</span> <span class="o">=</span> <span class="n">UserMicroChallengeGoalStatus</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_micro_chal</span><span class="o">=</span><span class="n">uc</span><span class="p">,</span> <span class="n">micro_chal_goal</span><span class="o">=</span><span class="n">goal</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">user_micro_chal_goal_status</span><span class="o">.</span><span class="n">complete</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">uc</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">&gt;=</span> <span class="n">goal</span><span class="o">.</span><span class="n">goal_state</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;User achieved goal for challenge: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">micro_chal</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                        <span class="n">notification</span> <span class="o">=</span> <span class="n">UserNotification</span><span class="p">()</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Achieved Medal: </span><span class="si">%s</span><span class="s"> for challenge: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">goal</span><span class="o">.</span><span class="n">medal</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">micro_chal</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">notification</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
                        <span class="n">notification</span><span class="o">.</span><span class="n">userProfile</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">profile</span>
                        <span class="n">notification</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                        <span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">total_pet_pennies</span> <span class="o">+=</span> <span class="n">goal</span><span class="o">.</span><span class="n">pet_pennies_reward</span>
                        <span class="n">user_micro_chal_goal_status</span><span class="o">.</span><span class="n">complete</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">user_micro_chal_goal_status</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">goal</span><span class="o">.</span><span class="n">medal</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;Gold&quot;</span><span class="p">:</span>
                            <span class="n">uc</span><span class="o">.</span><span class="n">complete</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="n">uc</span><span class="o">.</span><span class="n">date_completed</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="s">&#39;dateTime&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; 00:00:00+00:00&quot;</span>
                            <span class="n">uc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c"># Save complete challenge</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;User has not achieved goal for challenge: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">micro_chal</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">uc</span><span class="o">.</span><span class="n">date_end</span><span class="p">:</span>
                <span class="n">uc</span><span class="o">.</span><span class="n">complete</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Tracktivity Pets.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>